<!DOCTYPE html>
<html>
<head>
    <title>Corps & Robbers - HOST</title>
    <style>
        body { background-color: #0a0f0a; color: #00ff41; font-family: 'Courier New', monospace; text-align: center; }
        .container { max-width: 800px; margin: 0 auto; border: 4px solid #d4af37; padding: 20px; background: #1a1a1a; }
        h1 { color: #d4af37; text-transform: uppercase; font-size: 3em; margin-bottom: 5px; }
        #question-box { display: none; font-size: 1.5em; margin: 20px 0; border: 2px dashed #00ff41; padding: 20px; }
        .answers { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; }
        .ans-card { background: #333; padding: 15px; border: 1px solid #555; }
        #player-list { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-top: 30px; }
        .maggot { background: #d4af37; color: black; padding: 5px 15px; font-weight: bold; border-radius: 5px; }
        .btn { background: #c00; color: white; border: none; padding: 15px 30px; font-size: 1.2em; cursor: pointer; margin-top: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Corps & Robbers</h1>
        <h3 id="status">WAITING FOR CADETS...</h3>
        
        <div id="player-list"></div>
        <button id="start-btn" class="btn" onclick="startGame()">START EXERCISE</button>
        <button id="next-btn" class="btn" onclick="nextQuestion()" style="display:none;">NEXT QUESTION</button>

        <div id="question-box">
            <p id="q-text"></p>
            <div class="answers" id="answers-container"></div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        socket.emit('joinGame', { role: 'host' });

        socket.on('updatePlayerList', (players) => {
            const list = document.getElementById('player-list');
            list.innerHTML = players.map(p => `<div class="maggot">${p.name} (${p.score})</div>`).join('');
        });

        socket.on('newQuestion', (q) => {
            document.getElementById('status').innerText = "EYES FRONT!";
            document.getElementById('start-btn').style.display = 'none';
            document.getElementById('next-btn').style.display = 'block';
            document.getElementById('question-box').style.display = 'block';
            
            document.getElementById('q-text').innerText = q.question;
            document.getElementById('answers-container').innerHTML = q.answers.map(a => 
                `<div class="ans-card">${a}</div>`
            ).join('');
        });

        socket.on('playerAnswered', (data) => {
            // Visual feedback that someone answered
            console.log(data.name + " answered!");
        });

        socket.on('gameOver', (players) => {
            // 1. Sort players by score (Highest to Lowest)
            players.sort((a, b) => b.score - a.score);

            // 2. Generate Table Rows
            let rows = players.map((p, index) => {
                let rank = index + 1;
                // Gold for 1st, Green for others
                let color = (index === 0) ? '#d4af37' : '#00ff41'; 
                let icon = (index === 0) ? '‚≠ê' : ''; 

                return `
                    <tr style="color: ${color}; font-size: 1.5em; border-bottom: 1px dashed #333;">
                        <td style="padding: 10px; text-align: left;">#${rank} ${p.name} ${icon}</td>
                        <td style="padding: 10px; text-align: right; font-weight: bold; color: white;">
                            ${p.score !== undefined ? p.score : 0} PTS
                        </td>
                    </tr>
                `;
            }).join('');

            // 3. Inject the Final Scoreboard
            document.body.innerHTML = `
                <div class="container" style="margin-top: 50px; border-color: #c00;">
                    <h1 style="color: #c00; font-size: 3em;">FINAL STANDINGS</h1>
                    
                    <div style="background: #111; border: 2px solid #555; padding: 20px;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="color: #666; border-bottom: 2px solid #444; font-size: 0.8em;">
                                    <th style="text-align: left; padding-bottom: 10px;">MARINE</th>
                                    <th style="text-align: right; padding-bottom: 10px;">SCORE</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${rows}
                            </tbody>
                        </table>
                    </div>

                    <br>
                    <div style="color: #fff; font-size: 1.2em; margin-top: 20px;">
                        <p style="color: gold;">Winner: ${players[0].name}</p>
                        <button class="btn" onclick="location.reload()" style="background: #00ff41; color: black;">PLAY AGAIN</button>
                    </div>
                </div>
            `;
        });

        function startGame() { socket.emit('startGame'); }
        function nextQuestion() { socket.emit('nextQuestion'); }
    </script>
</body>
</html>
